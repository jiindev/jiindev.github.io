---
title: 'amplify로 갯츠비 배포하기'
date: '2020. 6. 14'
thumbnail: '/blog/gatsby-amplify5.jpg'
---
아이디어스 클론코딩을 마친 후 배포를 하는 과정에서 여러 문제점에 직면했습니다.
포트폴리오 사이트를 github pages로 배포하여 진행하니 사이트 이용에 큰 불편함이 없어 이번에도 page로 배포하고자 했는데, 기존에 블로그로 이미 해당 링크를 쓰고 있어서 
jiindev.github.io/idus-cloneCoding
링크에 배포가 되면서, 사이트의 절대 경로와 일치하지 않아 static 파일을 제대로 불러오지 못한 것입니다.
이러한 경우 어떤 식으로 처리해야 하는지 공식문서에서 설명해주고 있긴 합니다.
[공식 문서 설명](https://www.gatsbyjs.org/docs/how-gatsby-works-with-github-pages/)
<br/><br/>
gatsby-config.js 파일에 'pathPrefix: "/reponame"' 코드를 추가하고 gatsby pages에 배포하는 deploy 스크립트를 기존과 다른 형식으로 수정해주면 되는데요.
("deploy": "gatsby build --prefix-paths && gh-pages -d public")
<br/><br/>
이런 식으로 공식문서를 따라가며 진행을 했지만 계속하여 루트경로에서 static 파일을 불러오는 문제점이 생겼습니다. pathPrefix가 적용이 되지 않은 건데요.
<br/><br/>
찾아보니 저뿐만 아니라 다른 분들도 같은 문제점을 겪고 있고, 이것이 갯츠비에서 고쳐야 할 버그라고들 하여 결국 해결점을 찾지 못하고 다른 방법으로 배포를 하기로 했습니다.
갯츠비 공식 문서에서 netlify를 이용한 배포방법에 대해 최상단에서 자세히 설명을 하고 있어, 이번엔 netlify를 이용하여 진행을 하기로 했습니다.
<br/><br/>
netlify는 굉장히 쉽게 연결할 수 있으며 깃허브에 변경사항이 있을 시 자동으로 빌드를 해주며 따로 도메인 연결이 필요없이 주소 또한 제 마음대로 커스텀할 수 있어 상당히 편리했으나 이후 또 문제가 발생했습니다.
<br/><br/>
netlify로 배포한 사이트의 속도가 너무 느렸던건데요. 처음에는 속도에 그렇게까지 불편함을 느끼지 못했으나, 시간에 따라서 사이트의 속도가 달라지는 것을 느꼈습니다. 사이트를 형성하고 이미지를 로딩하는데 너무 오랜 시간이 걸려 이용자가 불편함을 느낄 수 밖에 없는 속도였습니다. 찾아보니 서버가 미국에 있어 한국에서 사용할 경우 속도가 더뎌진다고 하네요.
<br/><br/>
구직용으로 배포중인 사이트이기에 속도개선의 필요성을 느꼈고 결국 다른 배포방법을 또 다시 찾아보게 되었습니다. 기존에 dreamwitch를 aws를 통해 배포했을 때에 속도에서 크게 문제를 느끼지 못했으므로 aws 배포 방법을 찾아보았습니다.

#### aws Amplify

갯츠비에서 amplify를 이용한 배포방법을 설명하고 있었으므로 자연스럽게 amplify를 선택하게 되었는데요. 이용해보니 깃허브의 특정 레포지토리와 연결하여 netlify처럼 변동사항이 있을때마다 자동으로 빌도하도록 처리가 가능했습니다.
<br/><br/>
자세한 배포방법이 한글로 작성된 포스팅을 찾아보지 못해서 이번에 amplify를 이용해 배포하면서 겪은 과정을 아카이빙 해보고자 합니다.

[참고한 갯츠비 공식문서](https://www.gatsbyjs.org/docs/deploying-to-aws-amplify/)
<br/><br/>
1. 먼저 amplify 콘솔에 접근하여 Deploy 부분에서 get started를 클릭합니다.
[콘솔 바로가기](https://console.aws.amazon.com/amplify/home)
(* 꼭 리전을 '서울'로 지정하고 진행하야 합니다. 저의 경우 이전 dreamwitch 작업에서 리전이 오하이주로 설정되어 있는걸 모른채 진행했다가 낭패를 봤습니다.TT)
<br/><br/>

![레포지토리 선택화면 캡쳐](/blog/gatsby-amplify1.jpg)

2. 시작하기를 누르면 어떤 저장소의 어떤 레포지토리에 연결할지를 택하라고 합니다.
저의 경우 Github를 선택하여 연결하고, 아이디어스 클론코딩을 진행한 idus-cloneCoding 레포지토리를 선택했습니다.
어떤 브랜치를 기준으로 할지를 선택합니다.

<br/><br/>

![빌드 설정 구성화면 챕쳐](/blog/gatsby-amplify2.jpg)

3. amplify가 자동으로 코드를 분석하여 빌드방법을 정리한 데이터를 보여줍니다.
npm run build 명령어를 이용하여 빌드하고, 빌드된 파일은 public 폴더에 위치하는 것을 알려주네요.
틀린 점이 있다면 고쳐주고, 문제점이 없다면 다음으로 넘어갑니다.

<br/><br/>

![검토화면 캡쳐](/blog/gatsby-amplify2.jpg)

4. 마지막으로 설정한 내역을 한페이지에 보여줍니다. 
잘못 입력한 부분이 없다면 저장 및 배포를 눌러주면 amplify가 배포작업을 시작합니다.

![배포화면 캡쳐](/blog/gatsby-amplify4.jpg)

5. 배포는 버튼을 누른 즉시 되지는 않고, 제 체감으론 3분정도 기다렸던것 같습니다.
배포가 완료되면 이런 식으로 보여집니다. 접속하여 들어가보니 netlify로 배포했을 때보다 속도가 훨씬 개선됐음을 느낄 수 있었습니다. 

![사이트 캡쳐](/blog/gatsby-amplify5.jpg)
링크가 복잡한 것이 눈에 거슬려 가비아에서 저렴한 도메인을 구매하여 연결작업을 진행중인데요.
SSL을 확인하는 데에서 시간이 꽤 오래 걸리네요.
도메인을 연결한 이후에 도메인 연결 과정도 추가하여 서술하도록 하겠습니다.

#### 속도 비교

[netlify로 배포](https://jdus.netlify.app/)

[amplify로 배포](https://www.jdus.site/)